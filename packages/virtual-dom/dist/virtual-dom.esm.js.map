{"version":3,"file":"virtual-dom.esm.js","sources":["../../utils/src/store/node.ts","../../utils/src/tools/dom.ts","../src/serialize.ts","../src/dom.ts","../src/deserialize.ts"],"sourcesContent":["class NodeStore {\n    private static nodeId = 1\n    private nodeMap: Map<number, Node>\n    private idMap: WeakMap<Node, number>\n\n    constructor() {\n        this.init()\n    }\n\n    private init() {\n        this.nodeMap = new Map()\n        this.idMap = new WeakMap()\n    }\n\n    public reset() {\n        this.nodeMap.clear()\n    }\n\n    public createNodeId = () => NodeStore.nodeId++\n\n    public getNode(id: number) {\n        return this.nodeMap.get(id) || null\n    }\n\n    public addNode(node: Node, id: number = this.createNodeId()) {\n        this.idMap.set(node, id)\n        this.nodeMap.set(id, node)\n        return id\n    }\n\n    public removeNode(id: number) {\n        this.nodeMap.delete(id)\n        this.idMap.delete(this.getNode(id) as Node)\n    }\n\n    public getNodeId(node: Node) {\n        return this.idMap.get(node)\n    }\n\n    public updateNode(id: number, node: Node) {\n        this.idMap.set(node, id)\n        this.nodeMap.set(id, node)\n    }\n}\n\nexport const nodeStore = new NodeStore()\n","import { VNode } from '@timecat/share'\n\nconst snapshot = () => window.G_REPLAY_DATA && window.G_REPLAY_DATA.snapshot.data\n\nconst href = () => snapshot().href\n\nexport function isCommentNode(node: Node) {\n    return node.nodeType === Node.COMMENT_NODE\n}\n\nexport function isElementNode(node: Node) {\n    return node.nodeType === Node.ELEMENT_NODE\n}\n\nexport function isTextNode(node: Node) {\n    return node.nodeType === Node.TEXT_NODE\n}\n\nexport function filteringScriptTag(str: string) {\n    const reg = /<\\/script>/g\n    return str.replace(reg, '<\\\\/script>')\n}\n\nexport function completeCssHref(str: string, parentVNode?: VNode) {\n    return str.replace(/(url\\(['\"]?((\\/{1,2}|\\.\\.?\\/)[^'\"]*?)['\"]?(?=\\)))/g, (string, b, url) => {\n        if (!url.startsWith('data')) {\n            const baseUrl = parentVNode?.attrs['css-url'] || href()\n            const newUrl = new URL(url, baseUrl)\n            return string.replace(url, newUrl.href)\n        }\n        return string\n    })\n}\n\nexport function completeAttrHref(str: string, node?: Element) {\n    if (str.startsWith('data')) {\n        return str\n    }\n\n    if (node) {\n        setTimeout(() => {\n            const doc = node.getRootNode() as Document\n            const context = doc.defaultView as Window\n\n            const { href, path } = context?.G_REPLAY_LOCATION || {}\n\n            if (path && href) {\n                const relationHref = new URL(path, href)\n                const attrs = node.getAttributeNames()\n                attrs\n                    .filter(key => ~['src', 'href'].indexOf(key))\n                    .forEach(key => {\n                        const newHref = new URL(str, relationHref).href\n                        if (node.getAttribute(key) !== newHref) {\n                            node.setAttribute(key, newHref)\n                        }\n                    })\n            }\n        })\n    }\n    return new URL(str, href()).href\n}\n\nexport function isHideComment(node: Node | null) {\n    if (!node) {\n        return false\n    }\n    return node.nodeType === Node.COMMENT_NODE && node.textContent === 'hidden'\n}\n\nexport function isExistingNode(node: Node) {\n    return node.ownerDocument && !!node.ownerDocument.contains(node)\n}\n\nexport async function getRawScriptContent(src: string) {\n    if (!src) {\n        return false\n    }\n    if (src.length > 500) {\n        return false\n    }\n\n    const fullSrc = completeAttrHref(src)\n\n    if (isValidUrl(fullSrc)) {\n        try {\n            return await getScript(fullSrc)\n        } catch (err) {\n            // handle cross error\n            return false\n        }\n    }\n\n    return false\n}\n\nfunction isValidUrl(url: string) {\n    try {\n        new URL(url)\n    } catch (_) {\n        return false\n    }\n    return true\n}\n\nexport async function getScript(src: string) {\n    return await fetch(src).then(async res => filteringScriptTag(await res.text()))\n}\n","import { VNode, VSNode } from '@timecat/share'\nimport { nodeStore, isElementNode } from '@timecat/utils'\n\nconst getVNodeByEl = (el: Element, isSVG?: boolean): VNode | VSNode => {\n    if (isElementNode(el)) {\n        return {\n            id: nodeStore.createNodeId(),\n            type: el.nodeType,\n            attrs: getAttr(el as HTMLElement & { checked: boolean }),\n            tag: el.tagName.toLocaleLowerCase(),\n            children: [] as VNode[],\n            extra: getExtra(el, isSVG)\n        }\n    } else {\n        return {\n            id: nodeStore.createNodeId(),\n            type: el.nodeType,\n            value: el.textContent as string\n        }\n    }\n}\n\nconst getAttr = (el: HTMLElement & { checked: boolean }) => {\n    const resAttr: { [key: string]: string } = {}\n    const { attributes } = el\n    if (attributes && attributes.length) {\n        return Object.values(attributes).reduce((ret: { [key: string]: string }, attr) => {\n            const [name, value] = extraAttr(attr)\n\n            if (name) {\n                ret[name] = value\n            }\n            return ret\n        }, resAttr)\n    }\n    return resAttr\n}\n\nfunction getExtra(node: Element, isSVG?: boolean) {\n    const { tagName } = node\n    const extra: VNode['extra'] = {}\n    const props: VNode['extra']['props'] = {}\n\n    if (isSVG || tagName.toLowerCase() === 'svg') {\n        extra.isSVG = true\n    }\n\n    if (tagName === 'INPUT') {\n        const { checked, value } = node as any\n        if (value !== undefined) {\n            props.value = value\n        }\n        if (checked !== undefined) {\n            props.checked = checked\n        }\n    }\n\n    // find the scrolled elements\n    const scrollLeft = node.scrollLeft\n    const scrollTop = node.scrollTop\n    if (scrollTop || scrollLeft) {\n        props.scroll = {\n            left: scrollLeft,\n            top: scrollTop\n        }\n    }\n\n    if (Object.keys(props).length) {\n        extra.props = props\n    }\n\n    return extra\n}\n\nconst extraAttr = (attr: Attr) => {\n    const { name, value } = attr\n    if (name === 'href' || name === 'src') {\n        if (value.startsWith('#/')) {\n            return []\n        }\n        return [name, value]\n    }\n    return [name, value]\n}\n\nexport const createFlatVNode = (el: Element, isSVG = false) => {\n    const vNode = getVNodeByEl(el, isSVG)\n    const { id } = vNode\n    nodeStore.addNode(el, id)\n    return vNode\n}\n\nexport const createElement = (el: Element, inheritSVG?: boolean): VNode | VSNode | null => {\n    const vNode = getVNodeByEl(el, inheritSVG)\n    const { id } = vNode\n    nodeStore.addNode(el, id)\n\n    if (vNode.type === Node.ELEMENT_NODE) {\n        const vn = vNode as VNode\n        inheritSVG = inheritSVG || vn.extra.isSVG\n        el.childNodes.forEach((node: Element) => {\n            const child = createElement(node, inheritSVG)\n            if (child) {\n                vn.children.push(child)\n            }\n        })\n    }\n\n    return vNode\n}\n\nexport const virtualDOM = {\n    createElement\n}\n","import { completeAttrHref, completeCssHref } from '@timecat/utils'\n\nexport function setAttribute(node: HTMLElement, name: string, value: string | boolean | null): void {\n    if (node.nodeType !== Node.ELEMENT_NODE) {\n        return\n    }\n    if (name === 'style') {\n        if (typeof value === 'string') {\n            node.style.cssText = completeCssHref(value)\n        } else if (value !== null && typeof value === 'object') {\n            for (const [k, v] of Object.entries(value)) {\n                if (k[0] === '-') {\n                    node.style.setProperty(k, v as any)\n                } else {\n                    node.style[k as any] = v as any\n                }\n            }\n        }\n        return\n    }\n\n    // for disabled js prefetch\n    if (value && typeof value === 'string' && /\\.js$/.test(value)) {\n        return\n    }\n\n    if (!/^[\\w\\-\\d]+$/.test(name)) {\n        return\n    }\n\n    if (/^on\\w+$/.test(name)) {\n        return\n    }\n\n    if (value === null) {\n        return node.removeAttribute(name)\n    }\n\n    value = String(value)\n\n    if (name === 'href') {\n        value = completeAttrHref(String(value), node)\n    }\n\n    if (name === 'background' || name === 'src') {\n        if (value.startsWith('data:')) {\n            // skip\n        } else {\n            value = completeAttrHref(String(value), node)\n        }\n    }\n\n    // The srcset attribute specifies the URL of the image to use in different situations\n    if (name === 'srcset') {\n        const srcArray = value.split(',')\n        value = srcArray.map(src => completeAttrHref(src.trim(), node)).toString()\n    }\n\n    if (value.startsWith('/')) {\n        value = completeAttrHref(value, node)\n    }\n\n    return node.setAttribute(name, value)\n}\n","import { setAttribute } from './dom'\nimport { nodeStore, isDev, isHideComment, completeCssHref } from '@timecat/utils'\nimport { VNode, VSNode } from '@timecat/share'\n\nexport function convertVNode(vNode: VNode | VSNode | null, parent?: VNode): Element | null {\n    if (vNode === null || vNode === undefined) {\n        return null\n    }\n    const vs = vNode as VSNode\n    if (vNode.type === Node.COMMENT_NODE) {\n        return createCommentNode(vs) as Element\n    }\n    if (vNode.type === Node.TEXT_NODE) {\n        if (parent && parent.tag === 'style') {\n            vs.value = completeCssHref(vs.value, parent)\n        }\n        return createText(vs) as Element\n    }\n    const vn = vNode as VNode\n    const output = createNode(vn)\n\n    if ((vn.children && vn.children.length) || (output.childNodes && output.childNodes.length)) {\n        travel(vn, output)\n    }\n\n    return output\n}\n\nfunction travel(vNode: VNode, node: Element): void {\n    const nodeChildren: Element[] = []\n    const vNodeChildren = vNode.children.slice()\n    vNodeChildren.forEach(vChild => {\n        let child = nodeChildren.pop() as Element | null\n        child = convertVNode(vChild, vNode)\n        if (child) {\n            if (isHideComment(node.lastChild)) {\n                setAttribute(child as HTMLElement, 'style', 'visibility: hidden')\n            }\n            node.appendChild(child)\n        }\n    })\n}\n\nfunction createProps(vNode: VNode, node: Element): void {\n    const { props } = vNode.extra\n    if (props) {\n        for (const [key, val] of Object.entries(props)) {\n            if (key === 'scroll') {\n                const { left, top } = val as { top: number; left: number }\n                // TODO\n                // when the inserted element onload?\n                setTimeout(() => {\n                    node.scrollTop = top\n                    node.scrollLeft = left\n                }, 1000)\n            } else {\n                ;(node as any)[key] = val\n            }\n        }\n    }\n}\n\nfunction createAttributes(vNode: VNode, node: Element): void {\n    const attrs = getAttributes(vNode)\n\n    for (const [name, val] of Object.entries(attrs)) {\n        setAttribute(node as HTMLElement, name, val)\n    }\n    if (vNode.tag === 'a') {\n        node.setAttribute('target', '_blank')\n    }\n}\n\nfunction getAttributes(vNode: VNode) {\n    const attrs = { ...vNode.attrs }\n    if (vNode.tag === 'iframe') {\n        attrs['disabled-src'] = attrs.src\n        delete attrs.src\n    }\n    return attrs\n}\n\nexport function createSpecialNode(vsNode: VSNode) {\n    const { type, value, id } = vsNode\n\n    let output: Node\n\n    switch (type) {\n        case Node.TEXT_NODE:\n            output = document.createTextNode(value)\n            break\n        case Node.COMMENT_NODE:\n            output = document.createComment(value)\n            break\n    }\n    nodeStore.updateNode(id, output!)\n    return output!\n}\n\nexport function createNode(vNode: VNode): Element {\n    const { id, extra } = vNode\n    const { isSVG } = extra\n    let output: Element\n    const tagName = transformTagName(vNode.tag)\n    if (isSVG) {\n        output = document.createElementNS('http://www.w3.org/2000/svg', tagName)\n    } else {\n        output = document.createElement(tagName)\n    }\n\n    if (isDev) {\n        setAttribute(output as HTMLElement, 'vid', id.toString())\n    }\n    createAttributes(vNode, output)\n    createProps(vNode, output)\n    nodeStore.updateNode(id, output)\n    return output\n}\n\nfunction transformTagName(tag: string) {\n    const tagMap: { [key: string]: string } = {\n        // script deactivated\n        script: 'noscript',\n\n        // SVG transform tagName\n        altglyph: 'altGlyph',\n        altglyphdef: 'altGlyphDef',\n        altglyphitem: 'altGlyphItem',\n        animatecolor: 'animateColor',\n        animatemotion: 'animateMotion',\n        animatetransform: 'animateTransform',\n        clippath: 'clipPath',\n        feblend: 'feBlend',\n        fecolormatrix: 'feColorMatrix',\n        fecomponenttransfer: 'feComponentTransfer',\n        fecomposite: 'feComposite',\n        feconvolvematrix: 'feConvolveMatrix',\n        fediffuselighting: 'feDiffuseLighting',\n        fedisplacementmap: 'feDisplacementMap',\n        fedistantlight: 'feDistantLight',\n        feflood: 'feFlood',\n        fefunca: 'feFuncA',\n        fefuncb: 'feFuncB',\n        fefuncg: 'feFuncG',\n        fefuncr: 'feFuncR',\n        fegaussianblur: 'feGaussianBlur',\n        feimage: 'feImage',\n        femerge: 'feMerge',\n        femergenode: 'feMergeNode',\n        femorphology: 'feMorphology',\n        feoffset: 'feOffset',\n        fepointLight: 'fePointLight',\n        fespecularlighting: 'feSpecularLighting',\n        fespotlight: 'feSpotLight',\n        fetile: 'feTile',\n        feturbulence: 'feTurbulence',\n        foreignobject: 'foreignObject',\n        lineargradient: 'linearGradient',\n        radialgradient: 'radialGradient',\n        textpath: 'textPath'\n    }\n    const tagName = tagMap[tag] || tag\n    return tagName\n}\n\nfunction createText(vs: VSNode) {\n    const { value, id } = vs\n    const output: Node = document.createTextNode(value)\n    nodeStore.updateNode(id, output)\n    return output\n}\n\nfunction createCommentNode(vs: VSNode) {\n    const { value, id } = vs\n    const output: Node = document.createComment(value)\n    nodeStore.updateNode(id, output)\n    return output\n}\n"],"names":[],"mappings":"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"}